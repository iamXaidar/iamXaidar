# Quick Start

Мое руководство для начальной настройки сервера postgresql на русском с подробными комментариями. 

## Linux Kernel | Localhost

Установка необходимых сертификатов для безопасного ssl соединения:

```$ sudo apt install wget ca-certificates```

Создание и внесение в файл нужного дистрибутива для установки postgresql (это одна команда):

```$ sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'```

Импорт ключа:

```$ sudo  wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -```

Установка пакетов:

```$ sudo apt install postgresql postgresql-contrib```

Проверка статуса и запуск сервера:

```$ sudo service postgresql status```

```$ sudo service postgresql enable``` 

```$ sudo service postgresql start```

### Настройка входа
После установки необходимых пакетов, в системе создается новый пользователь postgres. Подключение к серверу postgresql по умолчанию настроено так, что для аутентификации пользователя базы данных, нужно сменить пользователя в системе и ввести команду psql. Это указано в файле конфигурации, где в таблице стоит метод Peer.

```* можно поменять в файле pg_hba.conf  метод peer на md5, чтобы входить по паролю.```

Меняем пользователя на postgres и заходим на сервер базы:
```$ sudo su - postgres``` 

```postgres $ psql```

### Добавление нового пользователя в базу

Хорошей практикой будет создать нового пользователя и дать ему права создавать роли и базы данных. Остальные супер права остаются у ```postgres```.

- если создать пользователя в базе с таким же именем, как и у пользователя в системе, то доступ к серверу станет возможным используя лишь команду psql в сеансе этого пользователя, без дополнительных параметров:

```postgres# CREATE USER <user_name> WITH CREATEDB CREATEROLE PASSWORD ‘user_password’;```

- стоит отметить, чтобы пользователь мог войти на сервер, должна быть создана одноименная база:

```postgres# CREATE DATABASE <user_name>;```

### Метод аутентификации пользователей

После создания пользователя нужно в файле конфигурации изменить режим аутентификации с ```Peer на md5 (пароль пользователя)```. 

По умолчанию у всех пользователей стоит аутентификация через пользователя в системе. То есть, чтобы войти на сервер под определенным пользователем, одноименная учетка должна быть активна и в системе.

Открыть файл конфигурации: 

```$ sudo nano /etc/postgresql/<version>/main/pg_hba.conf``` 

Поменять в конце строки метод аутентификации на md5 (по умолчанию стоит Peer):
```
# TYPE  DATABASE      USER    ADDRESS     METHOD
# "local" is for Unix domain socket connections only
local       all       all                 md5
```
- после внесения изменений нужно перезагрузить систему:

```$ sudo reboot```

Теперь можно войти на сервер под учетной записью созданного пользователя для создания баз, ролей и других пользователей:
```$ psql -U <user_name>```
### Основные команды для начала работы

- ROLE — это тоже самое что и USER, правда роли могут принимать в себя другие роли и иметь функционал групп. 

Создание пользователя:

```user=> CREATE USER <user_name> WITH [ATTR] PASSWORD ‘user_password’;```
- [ATTR — LOGIN (по умолчанию активен у USER), PASSWORD, CREATEDB, CREATEROLE, etc.]

Создание роли:

```user=> CREATE ROLE <rolename>; — по умолчанию без атрибута LOGIN;```

Создание базы:

```user=> CREATE DATABASE <dbname>;```

Отдать привилегии пользователю:

- привилегии в базе, в отдельной таблице  — бывает удобно создать пользователя и дать ему привилегии только в одной базе, что запретит ему работать с другими

```user=> GRANT [PRIVILEGES <LIST>, ALL PRIVILEGES] ON [DATABASE. TABLE, etc] <db_name> TO <username>;```

## Windows 10
